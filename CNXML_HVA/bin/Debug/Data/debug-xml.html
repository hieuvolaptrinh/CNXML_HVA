<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Debug XML Loading</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .test-card {
        background: white;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .success {
        color: #4caf50;
      }
      .error {
        color: #f44336;
      }
      .info {
        color: #2196f3;
      }
      pre {
        background: #f5f5f5;
        padding: 15px;
        border-radius: 4px;
        overflow-x: auto;
        max-height: 400px;
      }
      button {
        background: #4caf50;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #45a049;
      }
      .loading {
        display: none;
        color: #666;
      }
      .loading.active {
        display: inline-block;
      }
    </style>
    <script src="js/app.js"></script>
    <script src="js/crud.js"></script>
  </head>
  <body>
    <h1>üîç Debug XML Loading</h1>
    <p>C√¥ng c·ª• ki·ªÉm tra vi·ªác ƒë·ªçc file XML</p>

    <div class="test-card">
      <h2>Test 1: Ki·ªÉm tra XMLManager</h2>
      <button onclick="testXMLManager()">Ch·∫°y Test</button>
      <span class="loading" id="loading1">‚è≥ ƒêang t·∫£i...</span>
      <div id="result1"></div>
    </div>

    <div class="test-card">
      <h2>Test 2: ƒê·ªçc Customers.xml</h2>
      <button onclick="testCustomers()">Ch·∫°y Test</button>
      <span class="loading" id="loading2">‚è≥ ƒêang t·∫£i...</span>
      <div id="result2"></div>
    </div>

    <div class="test-card">
      <h2>Test 3: ƒê·ªçc Branches.xml</h2>
      <button onclick="testBranches()">Ch·∫°y Test</button>
      <span class="loading" id="loading3">‚è≥ ƒêang t·∫£i...</span>
      <div id="result3"></div>
    </div>

    <div class="test-card">
      <h2>Test 4: ƒê·ªçc Bookings.xml</h2>
      <button onclick="testBookings()">Ch·∫°y Test</button>
      <span class="loading" id="loading4">‚è≥ ƒêang t·∫£i...</span>
      <div id="result4"></div>
    </div>

    <div class="test-card">
      <h2>Test 5: ƒê·ªçc Fields.xml</h2>
      <button onclick="testFields()">Ch·∫°y Test</button>
      <span class="loading" id="loading5">‚è≥ ƒêang t·∫£i...</span>
      <div id="result5"></div>
    </div>

    <div class="test-card">
      <h2>üìä Console Logs</h2>
      <p class="info">M·ªü Developer Console (F12) ƒë·ªÉ xem chi ti·∫øt logs</p>
      <button onclick="window.location.reload()">üîÑ Refresh Page</button>
      <button onclick="clearTests()">üóëÔ∏è Clear Results</button>
    </div>

    <script>
      console.log("üöÄ Debug XML Page Loaded");
      console.log("XMLManager:", xmlManager);
      console.log(
        "CRUDManager:",
        typeof crudManager !== "undefined" ? crudManager : "NOT DEFINED"
      );

      function showLoading(id) {
        document.getElementById(`loading${id}`).classList.add("active");
      }

      function hideLoading(id) {
        document.getElementById(`loading${id}`).classList.remove("active");
      }

      function displayResult(id, html) {
        document.getElementById(`result${id}`).innerHTML = html;
      }

      async function testXMLManager() {
        showLoading(1);
        console.log("\n=== TEST 1: XMLManager ===");

        try {
          const xmlDoc = await xmlManager.loadXML("Customers.xml");
          console.log("‚úì XML Document loaded:", xmlDoc);

          const customers = xmlDoc.getElementsByTagName("customer");
          console.log(`‚úì Found ${customers.length} customer elements`);

          if (customers.length > 0) {
            const firstCustomer = customers[0];
            console.log("First customer:", firstCustomer);

            const name =
              firstCustomer.getElementsByTagName("name")[0]?.textContent;
            const phone =
              firstCustomer.getElementsByTagName("phone")[0]?.textContent;

            displayResult(
              1,
              `
                        <p class="success">‚úì XMLManager ho·∫°t ƒë·ªông t·ªët!</p>
                        <p>T√¨m th·∫•y ${customers.length} kh√°ch h√†ng</p>
                        <p><strong>Kh√°ch h√†ng ƒë·∫ßu ti√™n:</strong></p>
                        <ul>
                            <li>T√™n: ${name || "N/A"}</li>
                            <li>SƒêT: ${phone || "N/A"}</li>
                        </ul>
                        <p class="info">üí° Xem Console ƒë·ªÉ th·∫•y raw XML data</p>
                    `
            );
          } else {
            displayResult(
              1,
              `<p class="error">‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y customer n√†o trong XML</p>`
            );
          }
        } catch (error) {
          console.error("‚úó Test failed:", error);
          displayResult(
            1,
            `<p class="error">‚úó L·ªói: ${error.message}</p><pre>${error.stack}</pre>`
          );
        }

        hideLoading(1);
      }

      async function testCustomers() {
        showLoading(2);
        console.log("\n=== TEST 2: Customers ===");

        try {
          const customers = await crudManager.getMergedData(
            "Customers.xml",
            "customer"
          );
          console.log("‚úì Loaded customers:", customers);

          displayResult(
            2,
            `
                    <p class="success">‚úì ƒê·ªçc th√†nh c√¥ng ${
                      customers.length
                    } kh√°ch h√†ng</p>
                    <pre>${JSON.stringify(customers, null, 2)}</pre>
                `
          );
        } catch (error) {
          console.error("‚úó Test failed:", error);
          displayResult(2, `<p class="error">‚úó L·ªói: ${error.message}</p>`);
        }

        hideLoading(2);
      }

      async function testBranches() {
        showLoading(3);
        console.log("\n=== TEST 3: Branches ===");

        try {
          const branches = await crudManager.getMergedData(
            "Branches.xml",
            "branch"
          );
          console.log("‚úì Loaded branches:", branches);

          displayResult(
            3,
            `
                    <p class="success">‚úì ƒê·ªçc th√†nh c√¥ng ${
                      branches.length
                    } chi nh√°nh</p>
                    <pre>${JSON.stringify(branches, null, 2)}</pre>
                `
          );
        } catch (error) {
          console.error("‚úó Test failed:", error);
          displayResult(3, `<p class="error">‚úó L·ªói: ${error.message}</p>`);
        }

        hideLoading(3);
      }

      async function testBookings() {
        showLoading(4);
        console.log("\n=== TEST 4: Bookings ===");

        try {
          const bookings = await crudManager.getMergedData(
            "Bookings.xml",
            "booking"
          );
          console.log("‚úì Loaded bookings:", bookings);

          displayResult(
            4,
            `
                    <p class="success">‚úì ƒê·ªçc th√†nh c√¥ng ${
                      bookings.length
                    } booking</p>
                    <pre>${JSON.stringify(bookings, null, 2)}</pre>
                `
          );
        } catch (error) {
          console.error("‚úó Test failed:", error);
          displayResult(4, `<p class="error">‚úó L·ªói: ${error.message}</p>`);
        }

        hideLoading(4);
      }

      async function testFields() {
        showLoading(5);
        console.log("\n=== TEST 5: Fields ===");

        try {
          const fields = await crudManager.getMergedData("Fields.xml", "field");
          console.log("‚úì Loaded fields:", fields);

          displayResult(
            5,
            `
                    <p class="success">‚úì ƒê·ªçc th√†nh c√¥ng ${fields.length} s√¢n</p>
                    <pre>${JSON.stringify(fields, null, 2)}</pre>
                `
          );
        } catch (error) {
          console.error("‚úó Test failed:", error);
          displayResult(5, `<p class="error">‚úó L·ªói: ${error.message}</p>`);
        }

        hideLoading(5);
      }

      function clearTests() {
        for (let i = 1; i <= 5; i++) {
          displayResult(i, "");
        }
      }

      // Auto run Test 1 on load
      window.addEventListener("DOMContentLoaded", () => {
        console.log("‚úì Page ready, auto-running Test 1...");
        setTimeout(() => testXMLManager(), 500);
      });
    </script>
  </body>
</html>
