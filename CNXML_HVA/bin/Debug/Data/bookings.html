<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ƒê·∫∑t s√¢n - H·ªá Th·ªëng S√¢n B√≥ng</title>
    <link rel="stylesheet" href="css/styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="js/app.js"></script>
    <script src="js/crud.js"></script>
    <script src="js/components.js"></script>
  </head>
  <body>
    <div id="sidebar"></div>

    <div style="margin-left: 280px; padding: 30px">
      <div
        class="grass-pattern grass-overlay"
        style="padding: 40px 30px; border-radius: 16px; margin-bottom: 30px"
      >
        <div style="position: relative; z-index: 1">
          <h1
            style="
              color: white;
              font-size: 2.5em;
              margin-bottom: 10px;
              text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            "
          >
            <i class="fas fa-calendar-check"></i> Qu·∫£n L√Ω ƒê·∫∑t S√¢n
          </h1>
          <p style="color: rgba(255, 255, 255, 0.9); font-size: 1.1em">
            Theo d√µi v√† qu·∫£n l√Ω c√°c booking ƒë·∫∑t s√¢n
          </p>
        </div>
      </div>

      <div
        style="
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
          gap: 20px;
          margin-bottom: 30px;
        "
      >
        <div class="stat-card">
          <div
            class="stat-icon"
            style="
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            "
          >
            <i class="fas fa-calendar-alt"></i>
          </div>
          <div class="stat-details">
            <div class="stat-value" id="totalBookings">0</div>
            <div class="stat-label">T·ªïng ƒë·∫∑t s√¢n</div>
          </div>
        </div>
        <div class="stat-card">
          <div
            class="stat-icon"
            style="
              background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            "
          >
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="stat-details">
            <div class="stat-value" id="confirmedBookings">0</div>
            <div class="stat-label">ƒê√£ x√°c nh·∫≠n</div>
          </div>
        </div>
        <div class="stat-card">
          <div
            class="stat-icon"
            style="
              background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            "
          >
            <i class="fas fa-dollar-sign"></i>
          </div>
          <div class="stat-details">
            <div class="stat-value" id="totalRevenue">0ƒë</div>
            <div class="stat-label">T·ªïng doanh thu</div>
          </div>
        </div>
      </div>

      <div
        class="toolbar-container"
        style="
          background: white;
          padding: 20px;
          border-radius: 12px;
          margin-bottom: 25px;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        "
      >
        <div
          style="display: flex; gap: 15px; flex-wrap: wrap; align-items: center"
        >
          <button class="btn btn-primary" onclick="showAddBookingForm()">
            <i class="fas fa-plus"></i> Th√™m ƒê·∫∑t S√¢n
          </button>
          <div style="flex: 1; min-width: 250px">
            <input
              type="text"
              id="searchInput"
              placeholder="üîç T√¨m ki·∫øm ƒë·∫∑t s√¢n..."
              style="
                width: 100%;
                padding: 10px 15px;
                border: 1px solid #ddd;
                border-radius: 8px;
                font-size: 14px;
              "
            />
          </div>
          <select
            id="statusFilter"
            style="
              padding: 10px 15px;
              border: 1px solid #ddd;
              border-radius: 8px;
              min-width: 150px;
            "
          >
            <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
            <option value="Confirmed">ƒê√£ x√°c nh·∫≠n</option>
            <option value="Pending">Ch·ªù x√°c nh·∫≠n</option>
            <option value="Cancelled">ƒê√£ h·ªßy</option>
            <option value="Completed">Ho√†n th√†nh</option>
          </select>
        </div>
      </div>

      <div
        id="bookingsTable"
        style="
          background: white;
          border-radius: 12px;
          overflow: hidden;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        "
      >
        <table style="width: 100%; border-collapse: collapse">
          <thead
            style="
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              color: white;
            "
          >
            <tr>
              <th style="padding: 15px; text-align: left">M√£ ƒë·∫∑t</th>
              <th style="padding: 15px; text-align: left">Kh√°ch h√†ng</th>
              <th style="padding: 15px; text-align: left">S√¢n</th>
              <th style="padding: 15px; text-align: left">Ng√†y ƒë·∫∑t</th>
              <th style="padding: 15px; text-align: left">Gi·ªù</th>
              <th style="padding: 15px; text-align: right">Gi√°</th>
              <th style="padding: 15px; text-align: center">Tr·∫°ng th√°i</th>
              <th style="padding: 15px; text-align: center">Thao t√°c</th>
            </tr>
          </thead>
          <tbody id="bookingsTableBody"></tbody>
        </table>
      </div>
    </div>

    <script>
      let allBookings = [];
      let filteredBookings = [];
      let allCustomers = [];
      let allFields = [];

      document.addEventListener("DOMContentLoaded", async () => {
        document.getElementById("sidebar").innerHTML =
          createSidebar("bookings");
        requireAuth();
        await loadAllData();
        setupEventListeners();
      });

      async function loadAllData() {
        try {
          LoadingOverlay.show();
          // Load bookings, customers, and fields data in parallel
          const [bookings, customers, fields] = await Promise.all([
            crudManager.getMergedData("Bookings.xml", "Booking"),
            crudManager.getMergedData("Customers.xml", "customer"),
            crudManager.getMergedData("Fields.xml", "field"),
          ]);

          allBookings = bookings;
          allCustomers = customers;
          allFields = fields;

          console.log("Loaded bookings:", allBookings);
          console.log("Loaded customers:", allCustomers);
          console.log("Loaded fields:", allFields);

          filteredBookings = [...allBookings];
          renderBookings();
          updateStats();
          LoadingOverlay.hide();
        } catch (error) {
          console.error("Error loading data:", error);
          LoadingOverlay.hide();
          Toast.error("Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu: " + error.message);
        }
      }

      async function loadBookings() {
        await loadAllData();
      }

      function renderBookings() {
        const tbody = document.getElementById("bookingsTableBody");

        if (filteredBookings.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="8" style="text-align: center; padding: 60px 20px; color: #999;">
                <i class="fas fa-calendar-times" style="font-size: 3em; margin-bottom: 15px; display: block;"></i>
                Kh√¥ng t√¨m th·∫•y ƒë·∫∑t s√¢n n√†o
              </td>
            </tr>
          `;
          return;
        }

        tbody.innerHTML = filteredBookings
          .map((booking, index) => {
            const statusColors = {
              Confirmed: { bg: "#4CAF50", text: "ƒê√£ x√°c nh·∫≠n" },
              Pending: { bg: "#FF9800", text: "Ch·ªù x√°c nh·∫≠n" },
              Cancelled: { bg: "#f44336", text: "ƒê√£ h·ªßy" },
              Completed: { bg: "#2196F3", text: "Ho√†n th√†nh" },
            };
            const status =
              statusColors[booking.status] || statusColors.Confirmed;

            // Calculate price based on duration (150k per hour)
            const duration = parseInt(booking.duration) || 1;
            const price = duration * 150000;

            // Format time display
            const startTime = parseInt(booking.time) || 7;
            const endTime = startTime + duration;

            return `
            <tr style="border-bottom: 1px solid #eee; ${
              index % 2 === 0 ? "background: #fafafa;" : ""
            }">
              <td style="padding: 15px;"><strong>${
                booking.id || "N/A"
              }</strong></td>
              <td style="padding: 15px;">${booking.customer || "N/A"}</td>
              <td style="padding: 15px;">${booking.field || "N/A"}</td>
              <td style="padding: 15px;">${formatDate(booking.date)}</td>
              <td style="padding: 15px;">${startTime}:00 - ${endTime}:00 (${duration}h)</td>
              <td style="padding: 15px; text-align: right; font-weight: bold; color: #4CAF50;">${formatCurrency(
                price
              )}</td>
              <td style="padding: 15px; text-align: center;">
                <span style="background: ${
                  status.bg
                }; color: white; padding: 6px 12px; border-radius: 20px; font-size: 0.85em; white-space: nowrap;">
                  ${status.text}
                </span>
              </td>
              <td style="padding: 15px; text-align: center;">
                <div style="display: flex; gap: 8px; justify-content: center;">
                  <button class="btn btn-sm btn-info" onclick="viewBooking('${
                    booking.id
                  }')" title="Xem chi ti·∫øt">
                    <i class="fas fa-eye"></i>
                  </button>
                  <button class="btn btn-sm btn-primary" onclick="editBooking('${
                    booking.id
                  }')" title="S·ª≠a">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="btn btn-sm btn-danger" onclick="deleteBooking('${
                    booking.id
                  }')" title="X√≥a">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          `;
          })
          .join("");
      }

      function updateStats() {
        document.getElementById("totalBookings").textContent =
          allBookings.length;
        document.getElementById("confirmedBookings").textContent =
          allBookings.filter(
            (b) => b.status === "Confirmed" || !b.status
          ).length;

        // Calculate total revenue (150k per hour)
        const totalRevenue = allBookings.reduce(
          (sum, b) => sum + (parseInt(b.duration) || 1) * 150000,
          0
        );
        document.getElementById("totalRevenue").textContent =
          formatCurrency(totalRevenue);
      }

      function setupEventListeners() {
        document
          .getElementById("searchInput")
          .addEventListener("input", debounce(filterBookings, 300));
        document
          .getElementById("statusFilter")
          .addEventListener("change", filterBookings);
      }

      function filterBookings() {
        const searchTerm = document
          .getElementById("searchInput")
          .value.toLowerCase();
        const statusFilter = document.getElementById("statusFilter").value;

        filteredBookings = allBookings.filter((booking) => {
          const matchesSearch =
            !searchTerm ||
            (booking.id || "").toLowerCase().includes(searchTerm) ||
            (booking.customer || "").toLowerCase().includes(searchTerm) ||
            (booking.field || "").toLowerCase().includes(searchTerm);

          const matchesStatus =
            !statusFilter ||
            booking.status === statusFilter ||
            (!booking.status && statusFilter === "Confirmed");

          return matchesSearch && matchesStatus;
        });

        renderBookings();
      }

      // Generate customer options
      function getCustomerOptions(selectedCustomer = "") {
        return allCustomers
          .map((c) => {
            const name = c.tenkhachhang || c.name || c.id;
            const selected = name === selectedCustomer ? "selected" : "";
            return `<option value="${name}" ${selected}>${name} (${
              c.sdt || c.phone || "N/A"
            })</option>`;
          })
          .join("");
      }

      // Generate field options
      function getFieldOptions(selectedField = "") {
        return allFields
          .map((f) => {
            const name = f.tensan || f.name || f.id;
            const selected = name === selectedField ? "selected" : "";
            return `<option value="${name}" ${selected}>${name} - ${formatCurrency(
              f.gia || f.price_per_hour || 150000
            )}/h</option>`;
          })
          .join("");
      }

      // Generate next booking ID
      function getNextBookingId() {
        const maxNum = allBookings.reduce((max, b) => {
          const num = parseInt((b.id || "").replace(/\D/g, "") || "0");
          return num > max ? num : max;
        }, 0);
        return `B${String(maxNum + 1).padStart(3, "0")}`;
      }

      function showAddBookingForm() {
        const today = new Date().toISOString().split("T")[0];
        const nextId = getNextBookingId();

        const formHTML = `
          <form id="bookingForm" style="display: grid; gap: 15px;">
            <div class="form-group">
              <label>M√£ ƒë·∫∑t l·ªãch <span style="color: red;">*</span></label>
              <input type="text" name="id" required class="form-control" value="${nextId}">
            </div>
            <div class="form-group">
              <label>Kh√°ch h√†ng <span style="color: red;">*</span></label>
              <select name="customer" required class="form-control">
                <option value="">-- Ch·ªçn kh√°ch h√†ng --</option>
                ${getCustomerOptions()}
              </select>
            </div>
            <div class="form-group">
              <label>S√¢n <span style="color: red;">*</span></label>
              <select name="field" required class="form-control" onchange="updateFieldType(this)">
                <option value="">-- Ch·ªçn s√¢n --</option>
                ${getFieldOptions()}
              </select>
            </div>
            <div class="form-group">
              <label>Lo·∫°i s√¢n <span style="color: red;">*</span></label>
              <select name="type" required class="form-control">
                <option value="">-- Ch·ªçn lo·∫°i s√¢n --</option>
                <option value="5 ng∆∞·ªùi">5 ng∆∞·ªùi</option>
                <option value="7 ng∆∞·ªùi">7 ng∆∞·ªùi</option>
                <option value="11 ng∆∞·ªùi">11 ng∆∞·ªùi</option>
              </select>
            </div>
            <div class="form-group">
              <label>Ng√†y ƒë·∫∑t <span style="color: red;">*</span></label>
              <input type="date" name="date" required class="form-control" value="${today}" min="${today}">
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
              <div class="form-group">
                <label>Gi·ªù b·∫Øt ƒë·∫ßu <span style="color: red;">*</span></label>
                <select name="time" required class="form-control">
                  <option value="">Ch·ªçn gi·ªù</option>
                  ${Array.from({ length: 14 }, (_, i) => i + 7)
                    .map((h) => `<option value="${h}">${h}:00</option>`)
                    .join("")}
                </select>
              </div>
              <div class="form-group">
                <label>Th·ªùi l∆∞·ª£ng <span style="color: red;">*</span></label>
                <select name="duration" required class="form-control" onchange="calculatePrice()">
                  <option value="1">1 gi·ªù - 150,000ƒë</option>
                  <option value="2">2 gi·ªù - 300,000ƒë</option>
                  <option value="3">3 gi·ªù - 450,000ƒë</option>
                  <option value="4">4 gi·ªù - 600,000ƒë</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label>Tr·∫°ng th√°i</label>
              <select name="status" class="form-control">
                <option value="Confirmed">ƒê√£ x√°c nh·∫≠n</option>
                <option value="Pending">Ch·ªù x√°c nh·∫≠n</option>
              </select>
            </div>
            <div class="form-group">
              <label>Ghi ch√∫</label>
              <textarea name="note" class="form-control" rows="2" placeholder="Nh·∫≠p ghi ch√∫..."></textarea>
            </div>
            <div class="alert" style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); padding: 15px; border-radius: 8px; margin-top: 10px;">
              <i class="fas fa-info-circle" style="color: #1976d2;"></i> 
              <strong style="color: #1565c0;">Th√¥ng tin gi√°:</strong> 150,000ƒë/gi·ªù
            </div>
          </form>
        `;

        formModal.show("Th√™m ƒê·∫∑t S√¢n M·ªõi", formHTML, async (data) => {
          try {
            LoadingOverlay.show();

            // Validate required fields
            if (!data.customer || !data.field || !data.date || !data.time) {
              Toast.error("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin b·∫Øt bu·ªôc!");
              LoadingOverlay.hide();
              return;
            }

            await crudManager.saveToXML("Bookings.xml", data, "create");
            formModal.close();
            Toast.success("Th√™m ƒë·∫∑t s√¢n th√†nh c√¥ng!");
            await loadBookings();
          } catch (error) {
            console.error("Error adding booking:", error);
            Toast.error("L·ªói khi th√™m ƒë·∫∑t s√¢n: " + error.message);
          } finally {
            LoadingOverlay.hide();
          }
        });
      }

      function viewBooking(id) {
        const booking = allBookings.find((b) => b.id === id);
        if (!booking) {
          Toast.error("Kh√¥ng t√¨m th·∫•y ƒë·∫∑t s√¢n!");
          return;
        }

        const duration = parseInt(booking.duration) || 1;
        const price = duration * 150000;
        const startTime = parseInt(booking.time) || 7;
        const endTime = startTime + duration;

        const content = `
          <div style="padding: 10px;">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
              <div>
                <h4 style="color: #667eea; margin-bottom: 15px;">
                  <i class="fas fa-info-circle"></i> Th√¥ng tin ƒë·∫∑t s√¢n
                </h4>
                <table style="width: 100%;">
                  <tr><td style="padding: 8px 0; color: #666;">M√£ ƒë·∫∑t:</td><td style="font-weight: bold;">${
                    booking.id
                  }</td></tr>
                  <tr><td style="padding: 8px 0; color: #666;">Kh√°ch h√†ng:</td><td style="font-weight: bold;">${
                    booking.customer
                  }</td></tr>
                  <tr><td style="padding: 8px 0; color: #666;">S√¢n:</td><td style="font-weight: bold;">${
                    booking.field
                  }</td></tr>
                  <tr><td style="padding: 8px 0; color: #666;">Lo·∫°i s√¢n:</td><td>${
                    booking.type || "N/A"
                  }</td></tr>
                </table>
              </div>
              <div>
                <h4 style="color: #667eea; margin-bottom: 15px;">
                  <i class="fas fa-clock"></i> Th·ªùi gian & Gi√°
                </h4>
                <table style="width: 100%;">
                  <tr><td style="padding: 8px 0; color: #666;">Ng√†y:</td><td style="font-weight: bold;">${formatDate(
                    booking.date
                  )}</td></tr>
                  <tr><td style="padding: 8px 0; color: #666;">Gi·ªù:</td><td style="font-weight: bold;">${startTime}:00 - ${endTime}:00</td></tr>
                  <tr><td style="padding: 8px 0; color: #666;">Th·ªùi l∆∞·ª£ng:</td><td>${duration} gi·ªù</td></tr>
                  <tr><td style="padding: 8px 0; color: #666;">T·ªïng ti·ªÅn:</td><td style="font-weight: bold; color: #4CAF50; font-size: 1.2em;">${formatCurrency(
                    price
                  )}</td></tr>
                </table>
              </div>
            </div>
            ${
              booking.note
                ? `
              <div style="margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 8px;">
                <h4 style="color: #666; margin-bottom: 10px;"><i class="fas fa-sticky-note"></i> Ghi ch√∫</h4>
                <p style="margin: 0;">${booking.note}</p>
              </div>
            `
                : ""
            }
          </div>
        `;

        detailModal.show(`Chi ti·∫øt ƒë·∫∑t s√¢n #${booking.id}`, content);
      }

      async function editBooking(id) {
        const booking = allBookings.find((b) => b.id === id);
        if (!booking) {
          Toast.error("Kh√¥ng t√¨m th·∫•y ƒë·∫∑t s√¢n!");
          return;
        }

        const formHTML = `
          <form id="bookingForm" style="display: grid; gap: 15px;">
            <div class="form-group">
              <label>M√£ ƒë·∫∑t l·ªãch</label>
              <input type="text" name="id" class="form-control" value="${
                booking.id
              }" readonly style="background: #f5f5f5;">
            </div>
            <div class="form-group">
              <label>Kh√°ch h√†ng <span style="color: red;">*</span></label>
              <select name="customer" required class="form-control">
                <option value="">-- Ch·ªçn kh√°ch h√†ng --</option>
                ${getCustomerOptions(booking.customer)}
              </select>
            </div>
            <div class="form-group">
              <label>S√¢n <span style="color: red;">*</span></label>
              <select name="field" required class="form-control">
                <option value="">-- Ch·ªçn s√¢n --</option>
                ${getFieldOptions(booking.field)}
              </select>
            </div>
            <div class="form-group">
              <label>Lo·∫°i s√¢n <span style="color: red;">*</span></label>
              <select name="type" required class="form-control">
                <option value="5 ng∆∞·ªùi" ${
                  booking.type === "5 ng∆∞·ªùi" ? "selected" : ""
                }>5 ng∆∞·ªùi</option>
                <option value="7 ng∆∞·ªùi" ${
                  booking.type === "7 ng∆∞·ªùi" ? "selected" : ""
                }>7 ng∆∞·ªùi</option>
                <option value="11 ng∆∞·ªùi" ${
                  booking.type === "11 ng∆∞·ªùi" ? "selected" : ""
                }>11 ng∆∞·ªùi</option>
              </select>
            </div>
            <div class="form-group">
              <label>Ng√†y ƒë·∫∑t <span style="color: red;">*</span></label>
              <input type="date" name="date" required class="form-control" value="${
                booking.date
              }">
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
              <div class="form-group">
                <label>Gi·ªù b·∫Øt ƒë·∫ßu <span style="color: red;">*</span></label>
                <select name="time" required class="form-control">
                  ${Array.from({ length: 14 }, (_, i) => i + 7)
                    .map(
                      (h) =>
                        `<option value="${h}" ${
                          parseInt(booking.time) === h ? "selected" : ""
                        }>${h}:00</option>`
                    )
                    .join("")}
                </select>
              </div>
              <div class="form-group">
                <label>Th·ªùi l∆∞·ª£ng <span style="color: red;">*</span></label>
                <select name="duration" required class="form-control">
                  <option value="1" ${
                    booking.duration == 1 ? "selected" : ""
                  }>1 gi·ªù</option>
                  <option value="2" ${
                    booking.duration == 2 ? "selected" : ""
                  }>2 gi·ªù</option>
                  <option value="3" ${
                    booking.duration == 3 ? "selected" : ""
                  }>3 gi·ªù</option>
                  <option value="4" ${
                    booking.duration == 4 ? "selected" : ""
                  }>4 gi·ªù</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label>Tr·∫°ng th√°i</label>
              <select name="status" class="form-control">
                <option value="Confirmed" ${
                  booking.status === "Confirmed" || !booking.status
                    ? "selected"
                    : ""
                }>ƒê√£ x√°c nh·∫≠n</option>
                <option value="Pending" ${
                  booking.status === "Pending" ? "selected" : ""
                }>Ch·ªù x√°c nh·∫≠n</option>
                <option value="Completed" ${
                  booking.status === "Completed" ? "selected" : ""
                }>Ho√†n th√†nh</option>
                <option value="Cancelled" ${
                  booking.status === "Cancelled" ? "selected" : ""
                }>ƒê√£ h·ªßy</option>
              </select>
            </div>
            <div class="form-group">
              <label>Ghi ch√∫</label>
              <textarea name="note" class="form-control" rows="2">${
                booking.note || ""
              }</textarea>
            </div>
          </form>
        `;

        formModal.show("Ch·ªânh S·ª≠a ƒê·∫∑t S√¢n", formHTML, async (data) => {
          try {
            LoadingOverlay.show();
            data.id = booking.id;
            await crudManager.saveToXML("Bookings.xml", data, "update");
            formModal.close();
            Toast.success("C·∫≠p nh·∫≠t ƒë·∫∑t s√¢n th√†nh c√¥ng!");
            await loadBookings();
          } catch (error) {
            console.error("Error updating booking:", error);
            Toast.error("L·ªói khi c·∫≠p nh·∫≠t ƒë·∫∑t s√¢n: " + error.message);
          } finally {
            LoadingOverlay.hide();
          }
        });
      }

      function deleteBooking(id) {
        const booking = allBookings.find((b) => b.id === id);
        if (!booking) {
          Toast.error("Kh√¥ng t√¨m th·∫•y ƒë·∫∑t s√¢n!");
          return;
        }

        ConfirmDialog.show(
          `B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ƒë·∫∑t s√¢n <strong>#${booking.id}</strong> c·ªßa kh√°ch h√†ng <strong>"${booking.customer}"</strong>?`,
          async () => {
            try {
              LoadingOverlay.show();
              await crudManager.saveToXML(
                "Bookings.xml",
                { id: booking.id },
                "delete"
              );
              Toast.success("X√≥a ƒë·∫∑t s√¢n th√†nh c√¥ng!");
              await loadBookings();
            } catch (error) {
              console.error("Error deleting booking:", error);
              Toast.error("L·ªói khi x√≥a ƒë·∫∑t s√¢n: " + error.message);
            } finally {
              LoadingOverlay.hide();
            }
          },
          "X√°c Nh·∫≠n X√≥a"
        );
      }

      // Export bookings to XML
      function exportBookingsXML() {
        crudManager.downloadXML("Bookings.xml", "Bookings", "Booking");
        Toast.success("ƒê√£ xu·∫•t file Bookings.xml!");
      }
    </script>
  </body>
</html>
