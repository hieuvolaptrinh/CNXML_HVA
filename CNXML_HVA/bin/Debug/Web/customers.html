<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quản lý Khách hàng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="js/app.js"></script>
    <script src="js/components.js"></script>
  </head>
  <body class="bg-gray-100">
    <div id="sidebar"></div>

    <div class="ml-64 p-8">
      <div class="mb-8">
        <h2 class="text-3xl font-bold text-gray-800 mb-2">
          Quản lý Khách hàng
        </h2>
        <p class="text-gray-600">Danh sách khách hàng và thành viên</p>
      </div>

      <div class="grid grid-cols-4 gap-6 mb-8">
        <div
          class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500"
        >
          <p class="text-gray-600 text-sm mb-1">Tổng KH</p>
          <p class="text-2xl font-bold" id="stat-total">0</p>
        </div>
        <div
          class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-yellow-500"
        >
          <p class="text-gray-600 text-sm mb-1">VIP</p>
          <p class="text-2xl font-bold" id="stat-vip">0</p>
        </div>
        <div
          class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-500"
        >
          <p class="text-gray-600 text-sm mb-1">Gold</p>
          <p class="text-2xl font-bold" id="stat-gold">0</p>
        </div>
        <div
          class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-gray-500"
        >
          <p class="text-gray-600 text-sm mb-1">Silver</p>
          <p class="text-2xl font-bold" id="stat-silver">0</p>
        </div>
      </div>

      <div class="bg-white rounded-xl shadow-lg overflow-hidden">
        <table class="w-full">
          <thead class="bg-gradient-to-r from-blue-600 to-blue-700 text-white">
            <tr>
              <th class="px-6 py-4 text-left">Mã KH</th>
              <th class="px-6 py-4 text-left">Họ tên</th>
              <th class="px-6 py-4 text-left">Số điện thoại</th>
              <th class="px-6 py-4 text-left">Email</th>
              <th class="px-6 py-4 text-left">Địa chỉ</th>
              <th class="px-6 py-4 text-left">Hạng thành viên</th>
              <th class="px-6 py-4 text-left">Ghi chú</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </div>

    <script>
      document.getElementById("sidebar").innerHTML = createSidebar("customers");
      if (!requireAuth()) throw new Error("Not authenticated");

      async function loadData() {
        try {
          const xmlDoc = await xmlManager.loadXML("Customers.xml");
          const items = xmlManager.xmlToArray(xmlDoc, "customer");
          const tbody = document.getElementById("tbody");
          tbody.innerHTML = "";

          let stats = { total: 0, vip: 0, gold: 0, silver: 0 };

          items.forEach((item) => {
            const id =
              item.getAttribute("id") || xmlManager.getElementText(item, "id");
            const name = xmlManager.getElementText(item, "name");
            const phone = xmlManager.getElementText(item, "phone");
            const email = xmlManager.getElementText(item, "email");
            const city = xmlManager.getElementText(item, "city");
            const district = xmlManager.getElementText(item, "district");
            const membership = xmlManager.getElementText(item, "membership");
            const notes = xmlManager.getElementText(item, "notes");

            stats.total++;
            if (membership === "VIP") stats.vip++;
            else if (membership === "Gold") stats.gold++;
            else if (membership === "Silver") stats.silver++;

            const membershipColors = {
              VIP: "bg-yellow-100 text-yellow-800",
              Gold: "bg-purple-100 text-purple-800",
              Silver: "bg-gray-100 text-gray-800",
              None: "bg-blue-100 text-blue-800",
            };

            const row = document.createElement("tr");
            row.className = "hover:bg-gray-50";
            row.innerHTML = `
                        <td class="px-6 py-4 font-medium">${id}</td>
                        <td class="px-6 py-4 font-semibold">${name}</td>
                        <td class="px-6 py-4">${phone}</td>
                        <td class="px-6 py-4">${email}</td>
                        <td class="px-6 py-4">${city}, ${district}</td>
                        <td class="px-6 py-4"><span class="px-3 py-1 rounded-full text-xs font-semibold ${
                          membershipColors[membership] ||
                          membershipColors["None"]
                        }">${membership}</span></td>
                        <td class="px-6 py-4 text-sm text-gray-600">${
                          notes || "-"
                        }</td>
                    `;
            tbody.appendChild(row);
          });

          document.getElementById("stat-total").textContent = stats.total;
          document.getElementById("stat-vip").textContent = stats.vip;
          document.getElementById("stat-gold").textContent = stats.gold;
          document.getElementById("stat-silver").textContent = stats.silver;
        } catch (error) {
          showNotification("Lỗi tải dữ liệu", "error");
        }
      }

      window.addEventListener("load", loadData);
    </script>
  </body>
</html>
