<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quản lý Sân bóng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="js/app.js"></script>
    <script src="js/components.js"></script>
  </head>
  <body class="bg-gray-100">
    <div id="sidebar"></div>

    <div class="ml-64 p-8">
      <div class="mb-8 flex justify-between items-center">
        <div>
          <h2 class="text-3xl font-bold text-gray-800 mb-2">
            Quản lý Sân bóng
          </h2>
          <p class="text-gray-600">Danh sách tất cả các sân</p>
        </div>
        <button
          onclick="location.reload()"
          class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center space-x-2"
        >
          <i class="fas fa-sync-alt"></i><span>Làm mới</span>
        </button>
      </div>

      <div class="grid grid-cols-4 gap-6 mb-8">
        <div
          class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500"
        >
          <p class="text-gray-600 text-sm mb-1">Tổng số sân</p>
          <p class="text-2xl font-bold" id="stat-total">0</p>
        </div>
        <div
          class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500"
        >
          <p class="text-gray-600 text-sm mb-1">Đang sẵn sàng</p>
          <p class="text-2xl font-bold" id="stat-available">0</p>
        </div>
        <div
          class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-orange-500"
        >
          <p class="text-gray-600 text-sm mb-1">Đang được đặt</p>
          <p class="text-2xl font-bold" id="stat-booked">0</p>
        </div>
        <div
          class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-red-500"
        >
          <p class="text-gray-600 text-sm mb-1">Bảo trì</p>
          <p class="text-2xl font-bold" id="stat-maintenance">0</p>
        </div>
      </div>

      <div class="bg-white rounded-xl shadow-lg overflow-hidden">
        <table class="w-full">
          <thead class="bg-gradient-to-r from-blue-600 to-blue-700 text-white">
            <tr>
              <th class="px-6 py-4 text-left">Mã sân</th>
              <th class="px-6 py-4 text-left">Tên sân</th>
              <th class="px-6 py-4 text-left">Loại sân</th>
              <th class="px-6 py-4 text-left">Chi nhánh</th>
              <th class="px-6 py-4 text-left">Giá/giờ</th>
              <th class="px-6 py-4 text-left">Sức chứa</th>
              <th class="px-6 py-4 text-left">Trạng thái</th>
            </tr>
          </thead>
          <tbody id="fields-tbody"></tbody>
        </table>
      </div>
    </div>

    <script>
      document.getElementById("sidebar").innerHTML = createSidebar("fields");
      if (!requireAuth()) throw new Error("Not authenticated");

      async function loadFields() {
        try {
          const xmlDoc = await xmlManager.loadXML("Fields.xml");
          const fields = xmlManager.xmlToArray(xmlDoc, "field");
          const tbody = document.getElementById("fields-tbody");
          tbody.innerHTML = "";

          let stats = { total: 0, available: 0, booked: 0, maintenance: 0 };

          fields.forEach((field) => {
            const id =
              field.getAttribute("id") ||
              xmlManager.getElementText(field, "id");
            const name = xmlManager.getElementText(field, "name");
            const fieldTypeId = xmlManager.getElementText(
              field,
              "field_type_id"
            );
            const branchId = xmlManager.getElementText(field, "branch_id");
            const pricePerHour = parseInt(
              xmlManager.getElementText(field, "price_per_hour", "0")
            );
            const capacity = xmlManager.getElementText(field, "capacity");
            const status = xmlManager.getElementText(field, "status");

            stats.total++;
            if (status === "Available") stats.available++;
            else if (status === "Booked") stats.booked++;
            else if (status === "Maintenance") stats.maintenance++;

            const row = document.createElement("tr");
            row.className = "hover:bg-gray-50";
            row.innerHTML = `
                        <td class="px-6 py-4 font-medium">${id}</td>
                        <td class="px-6 py-4 font-semibold">${name}</td>
                        <td class="px-6 py-4">${fieldTypeId}</td>
                        <td class="px-6 py-4">${branchId}</td>
                        <td class="px-6 py-4">${formatCurrency(
                          pricePerHour
                        )}</td>
                        <td class="px-6 py-4 text-center">${capacity}</td>
                        <td class="px-6 py-4"><span class="px-3 py-1 rounded-full text-xs font-semibold ${
                          status === "Available"
                            ? "bg-green-100 text-green-800"
                            : status === "Booked"
                            ? "bg-orange-100 text-orange-800"
                            : "bg-red-100 text-red-800"
                        }">${status}</span></td>
                    `;
            tbody.appendChild(row);
          });

          document.getElementById("stat-total").textContent = stats.total;
          document.getElementById("stat-available").textContent =
            stats.available;
          document.getElementById("stat-booked").textContent = stats.booked;
          document.getElementById("stat-maintenance").textContent =
            stats.maintenance;
        } catch (error) {
          showNotification("Lỗi tải dữ liệu", "error");
        }
      }

      window.addEventListener("load", loadFields);
    </script>
  </body>
</html>
